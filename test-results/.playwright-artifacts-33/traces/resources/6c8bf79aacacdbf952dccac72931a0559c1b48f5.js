define(["react","mendix/filters/builders","react-dom"],(function(e,t,n){"use strict";var o;!function(e){e.STRING="string",e.NUMBER="number",e.ENUMERATION="enum",e.DATE="date",e.ASSOCIATION="association"}(o||(o={}));const r="com.mendix.widgets.web.filterable.filterContext";function i(){const t=window[r];if(t)return{FilterContext:t};const n=e.createContext(void 0);return window[r]=n,{FilterContext:n}}const l=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);function a(e,t){if(function(e){return l(e,"arg1")&&l(e,"arg2")}(e)&&"attribute"===e.arg1.type&&e.arg1.attributeId===t.id&&(n=e.arg2,l(n,"type")&&l(n,"value")))return{type:e.name,value:e.arg2.value};var n}function s(e,t){var n;if(!e||!t)return[];return(null!==(n=c(t))&&void 0!==n?n:[]).flatMap((t=>{const n=a(t,e);return n?[n]:[]}))}function c(e){return!e||"function"!==e.type||"and"!==e.name&&"or"!==e.name?e?[e]:void 0:e.args.flatMap(c).filter((e=>void 0!==e))}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const d=e=>{e&&e.canExecute&&!e.isExecuting&&e.execute()};class m{constructor(e){u(this,"selectionValue",void 0),u(this,"type","Single"),this.selectionValue=e}updateProps(e){this.selectionValue=e}isSelected(e){var t;return(null===(t=this.selectionValue.selection)||void 0===t?void 0:t.id)===e.id}add(e){this.selectionValue.setSelection(e)}remove(e){this.selectionValue.setSelection(void 0)}}class h{constructor(e,t){u(this,"selectionValue",void 0),u(this,"selectableItems",void 0),u(this,"type","Multi"),u(this,"rangeStart",void 0),u(this,"rangeEnd",void 0),this.selectionValue=e,this.selectableItems=t,this.rangeStart=void 0}isSelected(e){return this.selectionValue.selection.some((t=>t.id===e.id))}updateProps(e,t){this.selectionValue=e,this.selectableItems=t}get selectionStatus(){return 0===this.selectionValue.selection.length?"none":this.selectionValue.selection.length===this.selectableItems.length?"all":"some"}add(e){this._add(e),this._setRangeStart(e),this._setRangeEnd(void 0)}remove(e){this.isSelected(e)&&this.selectionValue.setSelection(this.selectionValue.selection.filter((t=>t.id!==e.id))),this._resetRange()}reduceTo(e){this.selectionValue.setSelection([e]),this._setRangeStart(e),this._setRangeEnd(void 0)}_add(e){this.isSelected(e)||this.selectionValue.setSelection(this.selectionValue.selection.concat(e))}_setRangeStart(e){let t=-1;void 0!==e&&(t=this.selectableItems.indexOf(e)),this.rangeStart=t>-1?t:void 0}_setRangeEnd(e){if(void 0===e)return void(this.rangeEnd=void 0);const t=this.rangeEnd,n=this.selectableItems.indexOf(e);this.rangeEnd=n>-1?n:void 0,this._updateSelectionWithRange(this.rangeStart,t,n)}_updateSelectionWithRange(e,t,n){if(void 0===e)return;if(-1===n)return;if(t===n)return;if(void 0===t){const t=this._getRange(e,n);return void this.selectionValue.setSelection(t)}const o=this._getRange(e,t),r=this._getRange(e,n);let i=[];i=this._diff(i,o),i=this._union(i,r),this.selectionValue.setSelection(i)}_getRange(e,t){const n=this.selectableItems.length,[o,r]=[p(e,0,n),p(t,0,n)].sort(((e,t)=>e-t));return this.selectableItems.slice(o,r+1)}_resetRange(){this._setRangeStart(void 0),this._setRangeEnd(void 0)}_union(e,t){const n=[...e],o=new Set(e.map((e=>e.id)));for(const e of t)o.has(e.id)||(o.add(e.id),n.push(e));return n}_diff(e,t){const n=new Set(e),o=new Set(t.map((e=>e.id)));for(const e of n)o.has(e.id)&&n.delete(e);return Array.from(n)}selectAll(){this.selectionValue.setSelection(this.selectableItems),this._resetRange()}selectNone(){this.selectionValue.setSelection([]),this._resetRange()}selectUpTo(e){void 0===this.rangeStart?(this._add(e),this._setRangeStart(e)):this._setRangeEnd(e)}_findIndexInList(e,t,n){const o=this.selectableItems.length-1,r="forward"===t;if("edge"===n)return r?o:0;return p(r?e+n:e-n,0,o)}_findIndexInGrid(e,t,n){const{columnIndex:o}=function(e,t,n){if(n<0||n>=t)return{columnIndex:-1,rowIndex:-1};const o=n%e,r=function(e,t){return Math.floor(e/t)}(n,e);return{columnIndex:o,rowIndex:r}}(n,this.selectableItems.length,e);return"pagedown"===t?this.selectableItems.length-(n-o):"home"===t?e-o:"end"===t?e+(n-(o+1)):o}selectUpToAdjacent(e,t,n,o,r){if(!1===t)return void this._resetRange();if(void 0===this.rangeStart)return void this.reduceTo(e);const i=this.selectableItems.findIndex((t=>t.id===e.id));let l=-1;l="backward"===n||"forward"===n?this._findIndexInList(i,n,o):this._findIndexInGrid(i,n,null!=r?r:0),l!==i&&(void 0===this.rangeStart&&this._setRangeStart(e),this._setRangeEnd(this.selectableItems.at(l)))}}const p=(e,t,n)=>Math.min(Math.max(e,t),n);function f(t,n,o){const r=e.useRef([]),i=e.useRef(!1);i.current||(i.current="loading"!==(null==n?void 0:n.status)),e.useEffect((()=>{var e;const n=r.current,l=null!==(e=null==t?void 0:t.selection)&&void 0!==e?e:[],a=Array.isArray(l)?l:[l];(function(e,t){if(e.length!==t.length)return!1;const n=new Set(t.map((e=>e.id)));return e.every((e=>n.has(e.id)))})(n,a)||(r.current=a,i.current&&d(o))}),[null==t?void 0:t.selection,o]);const l=e.useRef(void 0);var a,s;void 0!==t&&("Single"===t.type?l.current?l.current.updateProps(t):l.current=new m(t):l.current?l.current.updateProps(t,null!==(a=n.items)&&void 0!==a?a:[]):l.current=new h(t,null!==(s=n.items)&&void 0!==s?s:[]));return l.current}const g=new Set(["KeyA","MetaLeft","MetaRight","ControlLeft","ControlRight"]),v=(e,t)=>{let n=!1;const[o,r]=function(e,t){let n=0,o=0;return[function(){for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];const a=(new Date).getTime()-o,s=()=>{n=0,o=(new Date).getTime(),e(...i)};n||(a>=t?s():n=window.setTimeout(s,t-a))},()=>{clearTimeout(n),n=0}]}((()=>{n=!0,e()}),500);return[{eventName:"onKeyDown",filter:(e,t)=>"Multi"===e.selectionType&&function(e){return"KeyA"===e.code&&(e.metaKey||e.ctrlKey)}(t),handler:o},{eventName:"onKeyUp",filter:(e,t)=>"Multi"===e.selectionType&&g.has(t.code)&&n,handler:()=>{n=!1,r(),null==t||t()}}]},w=e=>[{eventName:"onKeyDown",filter:(e,t)=>"ArrowUp"===t.code&&"Multi"===e.selectionType,handler:(t,n)=>{let{item:o}=t;return e(o,n.shiftKey,"backward",1)}},{eventName:"onKeyDown",filter:(e,t)=>"ArrowDown"===t.code&&"Multi"===e.selectionType,handler:(t,n)=>{let{item:o}=t;return e(o,n.shiftKey,"forward",1)}},{eventName:"onKeyDown",filter:(e,t)=>"PageUp"===t.code&&"Multi"===e.selectionType,handler:(t,n)=>{let{item:o,pageSize:r}=t;return e(o,n.shiftKey,"backward",r)}},{eventName:"onKeyDown",filter:(e,t)=>"PageDown"===t.code&&"Multi"===e.selectionType,handler:(t,n)=>{let{item:o,pageSize:r}=t;return e(o,n.shiftKey,"forward",r)}},{eventName:"onKeyDown",filter:(e,t)=>"Home"===t.code&&"Multi"===e.selectionType,handler:(t,n)=>{let{item:o}=t;return e(o,n.shiftKey,"backward","edge")}},{eventName:"onKeyDown",filter:(e,t)=>"End"===t.code&&"Multi"===e.selectionType,handler:(t,n)=>{let{item:o}=t;return e(o,n.shiftKey,"forward","edge")}}],b="com.mendix.widgets.web.selectable.selectionContext";class y{constructor(e,t){var n=this;u(this,"selection",void 0),u(this,"selectionHelper",void 0),u(this,"onSelect",(function(){n.selectionHelper&&("Multi"===n.selectionHelper.type?n._onSelectItemMulti(...arguments):n._onSelectItemSingle(...arguments))})),u(this,"_onSelectItemMulti",((e,t,n)=>{var o;"Multi"===(null===(o=this.selectionHelper)||void 0===o?void 0:o.type)&&(t?this.selectionHelper.selectUpTo(e):this.selectionHelper.isSelected(e)?this.selectionHelper.remove(e):n?this.selectionHelper.add(e):this.selectionHelper.reduceTo(e))})),u(this,"_onSelectItemSingle",(e=>{var t;"Single"===(null===(t=this.selectionHelper)||void 0===t?void 0:t.type)&&(this.selectionHelper.isSelected(e)?this.selectionHelper.remove(e):this.selectionHelper.add(e))})),u(this,"onSelectAll",(e=>{this.selectionHelper&&("Single"!==this.selectionHelper.type?"selectAll"!==e&&"all"===this.selectionHelper.selectionStatus?this.selectionHelper.selectNone():this.selectionHelper.selectAll():console.warn("Datagrid: calling onSelectAll in single selection mode have no effect"))})),u(this,"onSelectAdjacent",(function(){var e;"Multi"===(null===(e=n.selectionHelper)||void 0===e?void 0:e.type)&&n.selectionHelper.selectUpToAdjacent(...arguments)})),u(this,"isSelected",(e=>!!this.selectionHelper&&this.selectionHelper.isSelected(e))),this.selection=e,this.selectionHelper=t}get selectionType(){if(void 0===this.selection)return"None";if("object"==typeof this.selection)return this.selection.type;if("None"===this.selection||"Single"===this.selection||"Multi"===this.selection)return this.selection;throw new Error("Unknown selection type: ".concat(this.selection))}}function C(){const e="com.mendix.widgets.web.UUID";return window[e]||(window[e]=1),window[e]++}var x,E={exports:{}};
/*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  */x=E,function(){var e={}.hasOwnProperty;function t(){for(var n=[],o=0;o<arguments.length;o++){var r=arguments[o];if(r){var i=typeof r;if("string"===i||"number"===i)n.push(r);else if(Array.isArray(r)){if(r.length){var l=t.apply(null,r);l&&n.push(l)}}else if("object"===i){if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]")){n.push(r.toString());continue}for(var a in r)e.call(r,a)&&r[a]&&n.push(a)}}}return n.join(" ")}x.exports?(t.default=t,x.exports=t):window.classNames=t}();var S=E.exports;const I=e.forwardRef((function(t,n){let{className:o,borderTop:r,clickable:i,previewAsHidden:l,wrapText:a,alignment:s,tabIndex:c,...u}=t;return e.createElement("div",{className:S("td",{"td-borders":r,clickable:i,"hidden-column-preview":l,"wrap-text":a,["align-column-".concat(s)]:"string"==typeof s},o),role:"gridcell",tabIndex:null!=c?c:i?0:void 0,ref:n,...u})})),k=e.memo(I),M=Symbol("DefaultKeyNavContextValue"),N=e.createContext(M);function T(t){let{focusController:n,children:o}=t;const r=e.useMemo((()=>({focusController:n})),[n]);return e.createElement(N.Provider,{value:r},o)}function A(e,t){return"".concat(e,",").concat(t)}function _(e){const[t,n]=e.split(",");return[parseInt(t,10),parseInt(n,10)]}function D(t){const n=e.useRef(null),o=e.useRef(t.focusTarget),{focusController:r}=function(){const t=e.useContext(N);if(t===M)throw new Error("useKeyNavContext: context provider is missing");return t}(),[i,l]=e.useMemo((()=>{const e=A(t.columnIndex,t.rowIndex);return[e===r.focusTarget,e]}),[t.columnIndex,t.rowIndex,r.focusTarget]),[a,s]=e.useState({canFocus:!1});return e.useEffect((()=>{const e=e=>s((t=>e.lastPos===l?{canFocus:!1}:e.targetPos===l?{canFocus:e.shouldFocus}:t));return r.addListener(e),()=>r.removeListener(e)}),[r,l]),e.useEffect((()=>{const{current:e}=o;if(a.canFocus){const t="function"==typeof e?e():n.current;null==t||t.focus()}}),[a]),{ref:n,tabIndex:i?0:-1,"data-position":l}}const R=e.memo((function(t){var n;const o=D({columnIndex:null!==(n=t.columnIndex)&&void 0!==n?n:-1,rowIndex:t.rowIndex}),r=e.useMemo((()=>t.eventsController.getProps(t.item)),[t.item,t.eventsController]);return e.createElement(k,{alignment:t.column.alignment,borderTop:0===t.rowIndex,className:t.column.columnClass(t.item),wrapText:t.column.wrapText,clickable:t.clickable,previewAsHidden:t.preview&&(t.column.initiallyHidden||!t.column.visible),tabIndex:o.tabIndex,ref:o.ref,"data-position":o["data-position"],onClick:r.onClick,onDoubleClick:r.onDoubleClick,onMouseDown:r.onMouseDown,onKeyDown:r.onKeyDown,onKeyUp:r.onKeyUp,onFocus:r.onFocus},t.column.renderCellContent(t.item))}));function P(t){let{direction:n}=t;const o="pagination-icon ".concat(n);switch(n){case"forward":return e.createElement("span",{"aria-hidden":!0},e.createElement("svg",{className:o,viewBox:"0 0 32 32",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M17.81 6.63C17.48 6.37 17 6.61 17 7.02V24.98C17 25.4 17.48 25.63 17.81 25.37L28.5 16.39C28.76 16.19 28.76 15.8 28.5 15.6L17.81 6.63Z",fill:"currentColor"}),e.createElement("path",{d:"M4.81 6.63C4.48 6.37 4 6.61 4 7.02V24.98C4 25.4 4.48 25.63 4.81 25.37L15.5 16.39C15.76 16.19 15.76 15.8 15.5 15.6L4.81 6.63Z",fill:"currentColor"})));case"step-forward":return e.createElement("span",{"aria-hidden":!0},e.createElement("svg",{className:o,viewBox:"0 0 32 32",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M8.81 6.63C8.48 6.37 8 6.61 8 7.02V24.98C8 25.4 8.48 25.63 8.81 25.37L20.5 16.39C20.76 16.19 20.76 15.8 20.5 15.6L8.81 6.63Z",fill:"currentColor"}),e.createElement("path",{d:"M24 6H22V26H24V6Z",fill:"currentColor"})));case"backward":return e.createElement("span",{"aria-hidden":!0},e.createElement("svg",{className:o,viewBox:"0 0 32 32",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M14.19 6.63L3.51 15.61C3.25 15.81 3.25 16.2 3.51 16.4L14.2 25.38C14.53 25.64 15.01 25.4 15.01 24.99V7.02C15.01 6.6 14.53 6.37 14.2 6.63H14.19Z",fill:"currentColor"}),e.createElement("path",{d:"M27.19 6.63L16.5 15.61C16.24 15.81 16.24 16.2 16.5 16.4L27.19 25.38C27.52 25.64 28 25.4 28 24.99V7.02C28 6.6 27.52 6.37 27.19 6.63Z",fill:"currentColor"})));case"step-backward":return e.createElement("span",{"aria-hidden":!0},e.createElement("svg",{className:o,viewBox:"0 0 32 32",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M23.19 6.63L11.51 15.61C11.25 15.81 11.25 16.2 11.51 16.4L23.2 25.38C23.53 25.64 24.01 25.4 24.01 24.99V7.02C24.01 6.6 23.53 6.37 23.2 6.63H23.19Z",fill:"currentColor"}),e.createElement("path",{d:"M10 6H8V26H10V6Z",fill:"currentColor"})));default:return e.createElement("div",null)}}function O(t){var n,o,r,i,l,a,s;const c=void 0!==t.numberOfItems?Math.ceil(t.numberOfItems/t.pageSize):void 0,u=void 0!==c?c-1:0,d=void 0!==c,m=t.page*t.pageSize+1,h=t.canNextPage||!t.numberOfItems?(t.page+1)*t.pageSize:t.numberOfItems,p=e=>{t.setPaginationIndex&&t.setPaginationIndex(e)};if(0===t.numberOfItems)return null;const f="".concat(m," to ").concat(h," ").concat(d?"of ".concat(null!==(n=t.numberOfItems)&&void 0!==n?n:(null!=c?c:1)*t.pageSize):"");return e.createElement("div",{"aria-label":null!==(o=t.labelPagination)&&void 0!==o?o:"Pagination",className:"pagination-bar"},e.createElement("button",{className:"btn pagination-button",disabled:0===t.page,...L((()=>{t.gotoPage(0),p(0)})),"aria-label":null!==(r=t.labelFirstPage)&&void 0!==r?r:"Go to first page"},e.createElement(P,{direction:"step-backward"})),e.createElement("button",{className:"btn pagination-button",disabled:!t.canPreviousPage,...L((()=>{t.previousPage(),p(t.page-1)})),"aria-label":null!==(i=t.labelPreviousPage)&&void 0!==i?i:"Go to previous page"},e.createElement(P,{direction:"backward"})),e.createElement("span",{className:"sr-only sr-only-focusable"},null!==(l=t.labelPagingStatus)&&void 0!==l?l:"Currently showing"," ",f),e.createElement("div",{"aria-hidden":!0,className:"paging-status"},f),e.createElement("button",{"aria-label":null!==(a=t.labelNextPage)&&void 0!==a?a:"Go to next page",className:"btn pagination-button",disabled:!t.canNextPage,...L((()=>{t.nextPage(),p(t.page+1)}))},e.createElement(P,{direction:"forward"})),d&&e.createElement("button",{"aria-label":null!==(s=t.labelLastPage)&&void 0!==s?s:"Go to last page",className:"btn pagination-button",disabled:t.page===u,...L((()=>{t.gotoPage(u),p(u)}))},e.createElement(P,{direction:"step-forward"})))}function L(e){return{onClick:e,onKeyDown:t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),t.stopPropagation(),e())}}}const H=Symbol("NO_PROPS_VALUE"),z=e.createContext(H),F=z.Provider;function K(){const t=e.useContext(z);if(t===H)throw new Error("useTableProps: failed to get value from props provider.");return t}function V(t){let{id:n,value:o,onChange:r}=t;const i=e.useRef(null);return e.useEffect((()=>{i.current&&("all"===o||"none"===o?i.current.indeterminate=!1:"some"===o&&(i.current.indeterminate=!0))}),[o]),e.createElement("input",{id:n,type:"checkbox",className:"three-state-checkbox",ref:i,checked:"none"!==o,onChange:r})}function U(){const{selectActionHelper:t,selectionStatus:n}=K(),{showCheckboxColumn:o,showSelectAllToggle:r,onSelectAll:i}=t;if(!1===o)return e.createElement(e.Fragment,null);let l=null;if(r){if("unknown"===n)throw new Error("Don't know how to render checkbox with selectionStatus=unknown");l=e.createElement(V,{value:n,onChange:i})}return e.createElement("div",{className:"th widget-datagrid-col-select",role:"columnheader"},l)}function j(t){const n=e.useRef(t);return e.useEffect((()=>{n.current=t})),e.useCallback((function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return n.current&&n.current.apply(void 0,t)}),[])}function B(t){let{minWidth:n=50,setColumnWidth:o,onResizeEnds:r,onResizeStart:i}=t;const[l,a]=e.useState(!1),[s,c]=e.useState(0),[u,d]=e.useState(0),m=e.useRef(null),h=j(i),p=e.useCallback((e=>{const t=e.touches?e.touches[0].screenX:e.screenX;if(c(t),a(!0),m.current){const e=m.current.parentElement;d(e.clientWidth)}h()}),[h]),f=e.useCallback((()=>{l&&(a(!1),d(0),null==r||r())}),[r,l]),g=j(o),v=e.useCallback((e=>{if(!l)return;const t=e.touches?e.touches[0].screenX:e.screenX;if(u){let e=u-(s-t);e<n&&(e=n),g(e)}}),[l,u,s,n,g]);return e.useEffect((()=>(document.addEventListener("mousemove",v),document.addEventListener("mouseup",f),document.addEventListener("touchmove",v),document.addEventListener("touchend",f),()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",v),document.removeEventListener("touchend",f)})),[v,f]),e.createElement("div",{"aria-hidden":!0,ref:m,className:"column-resizer",onMouseDown:p,onTouchStart:p},e.createElement("div",{className:"column-resizer-bar"}))}function W(){return e.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"far","data-icon":"eye",className:"svg-inline--fa fa-eye fa-w-18",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0.589893 7.715C0.724893 7.52 3.91989 3 7.99989 3C12.0799 3 15.2749 7.52 15.4099 7.715L15.6099 8L15.4099 8.285C15.2749 8.48 12.0799 13 7.99989 13C3.91989 13 0.724893 8.48 0.589893 8.285L0.389893 8L0.589893 7.715ZM1.62489 8C2.37489 8.96 4.98989 12 7.99989 12C11.0099 12 13.6249 8.96 14.3749 8C13.6249 7.04 11.0099 4 7.99989 4C4.98989 4 2.37489 7.04 1.62489 8ZM5.5 8C5.5 6.62 6.62 5.5 8 5.5C9.38 5.5 10.5 6.62 10.5 8C10.5 9.38 9.38 10.5 8 10.5C6.62 10.5 5.5 9.38 5.5 8ZM6.5 8C6.5 8.825 7.175 9.5 8 9.5C8.825 9.5 9.5 8.825 9.5 8C9.5 7.175 8.825 6.5 8 6.5C7.175 6.5 6.5 7.175 6.5 8Z",fill:"currentColor"}))}function Z(t,n){e.useEffect((()=>{const{current:e}=Array.isArray(t)?t[0]:t;if(!e)return;const o=e.ownerDocument,r=function(e,t){const n=Array.isArray(e)?e:[e];return e=>{n.every((t=>{let{current:n}=t;return n&&!n.contains(e.target)}))&&t()}}(t,n);return o.addEventListener("mousedown",r),o.addEventListener("touchstart",r),()=>{o.removeEventListener("mousedown",r),o.removeEventListener("touchstart",r)}}),[t,n])}function G(t,n){const[o,r]=e.useState(),i=e.useCallback((()=>{r((e=>{const n=null==t?void 0:t.getBoundingClientRect();return r=n,(o=e)&&r&&o.height===r.height&&o.width===r.width&&o.bottom===r.bottom&&o.top===r.top&&o.left===r.left&&o.right===r.right?e:n;var o,r}))}),[t]);var l;return l=n?i:void 0,e.useEffect((()=>l?function(e){let t;const n=()=>{t=window.requestAnimationFrame((()=>{e(),n()}))},o=()=>window.cancelAnimationFrame(t);return n(),o}(l):void 0),[l]),o}const X=t=>{const n=t.current,[o,r]=e.useState(!0);return e.useLayoutEffect((()=>{const e=null==n?void 0:n.getBoundingClientRect(),t=!e||e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth);r(t)}),[n]),o};function q(t){var n;const{toggleHidden:o,visibleLength:r}=t,[i,l]=e.useState(!1),a=e.useRef(null),s=e.useRef(null),c=G(s.current,i);Z([s,a],(()=>l(!1)));const u=null!==(n=t.label)&&void 0!==n?n:"Column selector",d=X(a),m=e.useMemo((()=>t.columns.findIndex((e=>e.canHide))),[t.columns]),h=e.useMemo((()=>t.columns.map((e=>e.canHide)).lastIndexOf(!0)),[t.columns]),p=e.createElement("ul",{ref:a,id:"".concat(t.id,"-column-selectors"),className:"column-selectors ".concat(d?"":"overflow"),"data-focusindex":0,role:"menu",style:{position:"fixed",top:null==c?void 0:c.bottom,right:void 0!==(null==c?void 0:c.right)?document.body.clientWidth-c.right:void 0}},t.columns.map(((n,i)=>{const a=!t.hiddenColumns.has(n.columnId),c=a&&1===r,u=()=>{c||o(n.columnId)};return n.canHide?e.createElement("li",{key:n.columnNumber,onClick:e=>{e.preventDefault(),e.stopPropagation(),u()},onKeyDown:e=>{var t;"Enter"===e.key||" "===e.key?(e.preventDefault(),e.stopPropagation(),u()):("Tab"===e.key&&(i===h||e.shiftKey&&i===m)||"Escape"===e.key)&&(e.preventDefault(),l(!1),null===(t=s.current)||void 0===t||t.focus())},role:"menuitem",tabIndex:0},e.createElement("input",{checked:a,disabled:c,id:"".concat(t.id,"_checkbox_toggle_").concat(i),style:{pointerEvents:"none"},type:"checkbox",tabIndex:-1,onChange:J}),e.createElement("label",{htmlFor:"".concat(t.id,"_checkbox_toggle_").concat(i),style:{pointerEvents:"none"}},n.header)):null}))),f=e.useCallback((()=>{l((e=>!e)),setTimeout((()=>{var e,t;null===(t=null===(e=a.current)||void 0===e?void 0:e.querySelector("li"))||void 0===t||t.focus()}),10)}),[]);return e.createElement("div",{"aria-label":u,className:"th column-selector",role:"columnheader",title:u},e.createElement("div",{className:"column-selector-content"},e.createElement("button",{"aria-label":u,ref:s,className:"btn btn-default column-selector-button",onClick:f,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),f())},"aria-haspopup":!0,"aria-expanded":i,"aria-controls":"".concat(t.id,"-column-selectors")},e.createElement(W,null))),i&&p)}function J(){}function Y(t){const{children:n,className:o,...r}=t;return e.createElement("div",{className:S("widget-datagrid-grid table",o),role:"grid",...r},n)}function Q(t){return e.createElement("div",{...t,className:S("widget-datagrid-grid-body table-content",t.className),role:"rowgroup"})}function $(){return e.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"long-arrow-alt-down",className:"svg-inline--fa fa-long-arrow-alt-down fa-w-8",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 512"},e.createElement("path",{fill:"currentColor",d:"M168 345.941V44c0-6.627-5.373-12-12-12h-56c-6.627 0-12 5.373-12 12v301.941H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.569 9.373 33.941 0l86.059-86.059c15.119-15.119 4.411-40.971-16.971-40.971H168z"}))}function ee(){return e.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"long-arrow-alt-up",className:"svg-inline--fa fa-long-arrow-alt-up fa-w-8",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 512"},e.createElement("path",{fill:"currentColor",d:"M88 166.059V468c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12V166.059h46.059c21.382 0 32.09-25.851 16.971-40.971l-86.059-86.059c-9.373-9.373-24.569-9.373-33.941 0l-86.059 86.059c-15.119 15.119-4.411 40.971 16.971 40.971H88z"}))}function te(){return e.createElement("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"arrows-alt-v",className:"svg-inline--fa fa-arrows-alt-v fa-w-8",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 512"},e.createElement("path",{fill:"currentColor",d:"M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"}))}function ne(t){var n,o,r;const i=t.sortable&&t.column.canSort,l=t.draggable&&null!==(n=t.column.canDrag)&&void 0!==n&&n,a=function(t,n,o,r){const i=e.useCallback((e=>{var t;r(!0);const n=e.target;e.dataTransfer.setData(oe,null!==(t=n.dataset.columnId)&&void 0!==t?t:"")}),[r]),l=e.useCallback((e=>{e.preventDefault()}),[]),a=e.useCallback((e=>{const{dataset:{columnId:t}}=e.target;t!==e.dataTransfer.getData(oe)&&o(t)}),[o]),s=e.useCallback((()=>{r(!1),o(void 0)}),[o,r]),c=e.useCallback((e=>{s();const t=e.target.dataset.columnId,o=e.dataTransfer.getData(oe);n([t,o])}),[s,n]);return t?{draggable:!0,onDragStart:i,onDragOver:l,onDrop:c,onDragEnter:a,onDragEnd:s}:{}}(l,t.swapColumns,t.setDragOver,t.setIsDragging),s=!!t.sortRule,c=s&&"desc"===(null===(o=t.sortRule)||void 0===o?void 0:o[1]),u=i?s?c?e.createElement($,null):e.createElement(ee,null):e.createElement(te,null):null,d=t.column.header.trim(),m=()=>{t.setSortBy(t.column.columnId)},h={onClick:m,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),m())},role:"button",tabIndex:0};return e.createElement("div",{"aria-sort":i?s?c?"descending":"ascending":"none":void 0,className:S("th",{"hidden-column-preview":t.preview&&(t.hidable&&t.column.initiallyHidden||!t.column.visible)}),role:"columnheader",style:t.sortable&&t.column.canSort?void 0:{cursor:"unset"},title:d,ref:null===(r=t.useHeaderRef)||void 0===r?void 0:r.call(t,t.column.columnId)},e.createElement("div",{className:S("column-container",{dragging:l&&t.column.columnId===t.dragOver}),id:"".concat(t.gridId,"-column").concat(t.column.columnId),"data-column-id":t.column.columnId,...a},e.createElement("div",{className:S("column-header",i?"clickable":"",t.className),style:{pointerEvents:t.isDragging?"none":void 0},...i?h:void 0,"aria-label":i?"sort "+d:d},e.createElement("span",null,d.length>0?d:" "),u),t.filterable&&t.filterWidget),t.resizable&&t.column.canResize&&t.resizer)}const oe="application/x-mx-widget-web-datagrid-column-id";function re(t){return e.createElement(k,{...t,className:"column-selector"})}function ie(t){let{item:n,rowIndex:o,lastRow:r,...i}=t;const l=D({columnIndex:0,rowIndex:o}),{selectActionHelper:a,checkboxEventsController:s,selectRowLabel:c,rowClickable:u}=K();return e.createElement(k,{...i,clickable:u,className:"widget-datagrid-col-select",tabIndex:-1},e.createElement("input",{checked:a.isSelected(n),type:"checkbox",tabIndex:l.tabIndex,"data-position":l["data-position"],onChange:ae,onFocus:r?le:void 0,ref:l.ref,"aria-label":"".concat(null!=c?c:"Select row"," ").concat(o+1),...s.getProps(n)}))}function le(e){var t;"function"==typeof(null===(t=e.target.parentElement)||void 0===t?void 0:t.scrollIntoView)&&e.target.parentElement.scrollIntoView(!1)}function ae(){}function se(t){const{CellComponent:n}=t,{selectActionHelper:o,preview:r,data:i,rowClickable:l,cellEventsController:a}=K(),s=o.isSelected(t.item),c="None"===o.selectionType?void 0:s,u=0===t.index;return e.createElement("div",{className:S("tr",{"tr-selected":s},t.className),role:"row","aria-selected":c},o.showCheckboxColumn&&e.createElement(ie,{item:t.item,key:"checkbox_cell",borderTop:u,rowIndex:t.index,lastRow:t.index===i.length-1}),t.columns.map(((i,s)=>{const c=e.createElement(n,{key:"row_".concat(t.item.id,"_col_").concat(i.columnNumber),column:i,rowIndex:t.index,columnIndex:o.showCheckboxColumn?s+1:s,item:t.item,clickable:l,preview:r,eventsController:a});return r?t.selectableWrapper(s,c):c})),t.showSelectorCell&&e.createElement(re,{key:"column_selector_cell",borderTop:u,clickable:l,tabIndex:-1}))}function ce(t){var n,o;const[r,i]=e.useState(!1),l=null!==(o=(n=e.useRef()).current)&&void 0!==o?o:n.current=function(e){let{setIsIntersecting:t}=e;return new IntersectionObserver((e=>{let[n]=e;t(n.isIntersecting)}))}({setIsIntersecting:i});return e.useEffect((()=>(t.current&&l.observe(t.current),()=>{l.disconnect()})),[l,t]),r}const ue=30;function de(){const t=e.useRef(null),[n,o]=e.useState(1);return e.useEffect((()=>{const e=t.current;if(null!==e)return function(e,t){const n=new IntersectionObserver((e=>{let[n]=e;0!==n.intersectionRatio&&1!==n.intersectionRatio||t(n.intersectionRatio)}),{threshold:[0,1]});return n.observe(e),()=>n.unobserve(e)}(e,o)}),[]),e.createElement("div",{className:S("sticky-sentinel",{"container-stuck":0===n}),ref:t,style:{height:1,marginBottom:"-1px"}})}function me(t){let{children:n,className:o,hasMoreItems:r,isInfinite:i,style:l,setPage:a}=t;const[s,c,u]=function(t){const{setPage:n,hasMoreItems:o,isInfinite:r}=t,[i,l]=e.useState(0),a=e.useRef(null),s=ce(a),c=e.useCallback((e=>{Math.floor(e.target.scrollHeight-ue-e.target.scrollTop)<=Math.floor(e.target.clientHeight)+2&&o&&n&&n((e=>e+1))}),[o,n]),u=e.useCallback((()=>{s&&r&&o&&i<=0&&a.current&&l(a.current.clientHeight-ue)}),[r,o,i,s]);return e.useLayoutEffect((()=>{setTimeout((()=>u()),100)}),[u]),[c,i,a]}({hasMoreItems:r,isInfinite:i,setPage:a});return e.createElement("div",{className:S("widget-datagrid-content","sticky-table-container",{"infinite-loading":i},o),ref:u,onScroll:i?s:void 0,style:i&&c>0?{...l,maxHeight:c}:l},e.createElement(de,null),n)}function he(t){const{pagingPosition:n,pagination:o,...r}=t;return e.createElement("div",{...r,className:"widget-datagrid-footer table-footer"},("bottom"===n||"both"===n)&&o)}function pe(t){const{children:n,headerTitle:o,...r}=t;return n?e.createElement("div",{...r,className:"widget-datagrid-header header-filters","aria-label":o||void 0},n):null}function fe(t){const{className:n,selectionMethod:o,selection:r,exporting:i,children:l,...a}=t;return e.createElement("div",{...a,className:S(n,"widget-datagrid",{"widget-datagrid-exporting":i,"widget-datagrid-selectable-rows":r,"widget-datagrid-selection-method-checkbox":r&&"checkbox"===o,"widget-datagrid-selection-method-click":r&&"rowClick"===o})},l)}function ge(t){return e.createElement("div",{...t,className:"widget-datagrid-top-bar table-header"},t.children)}function ve(t){return e.createElement("div",{className:"widget-datagrid-modal-root",role:"presentation"},e.createElement("div",{className:"widget-datagrid-modal-overlay",role:"presentation"}),e.createElement("div",{className:"widget-datagrid-modal-main",role:"presentation"},t.children))}function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},we.apply(this,arguments)}function be(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];const r=n[0];if(1===n.length)return r;const i=()=>{const t=n.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(n){const o=t.reduce(((e,t)=>{let{useScope:o,scopeName:r}=t;return{...e,...o(n)["__scope".concat(r)]}}),{});return e.useMemo((()=>({["__scope".concat(r.scopeName)]:o})),[o])}};return i.scopeName=r.scopeName,i}function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ye.apply(this,arguments)}function Ce(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>t.forEach((t=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(t,e)))}const xe=e.forwardRef(((t,n)=>{const{children:o,...r}=t,i=e.Children.toArray(o),l=i.find(Ie);if(l){const t=l.props.children,o=i.map((n=>n===l?e.Children.count(t)>1?e.Children.only(null):e.isValidElement(t)?t.props.children:null:n));return e.createElement(Ee,ye({},r,{ref:n}),e.isValidElement(t)?e.cloneElement(t,void 0,o):null)}return e.createElement(Ee,ye({},r,{ref:n}),o)}));xe.displayName="Slot";const Ee=e.forwardRef(((t,n)=>{const{children:o,...r}=t;return e.isValidElement(o)?e.cloneElement(o,{...ke(r,o.props),ref:n?Ce(n,o.ref):o.ref}):e.Children.count(o)>1?e.Children.only(null):null}));Ee.displayName="SlotClone";const Se=t=>{let{children:n}=t;return e.createElement(e.Fragment,null,n)};function Ie(t){return e.isValidElement(t)&&t.type===Se}function ke(e,t){const n={...t};for(const o in t){const r=e[o],i=t[o];/^on[A-Z]/.test(o)?r&&i?n[o]=function(){i(...arguments),r(...arguments)}:r&&(n[o]=r):"style"===o?n[o]={...r,...i}:"className"===o&&(n[o]=[r,i].filter(Boolean).join(" "))}return{...e,...n}}const Me=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((t,n)=>{const o=e.forwardRef(((t,o)=>{const{asChild:r,...i}=t,l=r?xe:n;return e.useEffect((()=>{window[Symbol.for("radix-ui")]=!0}),[]),e.createElement(l,ye({},i,{ref:o}))}));return o.displayName="Primitive.".concat(n),{...t,[n]:o}}),{}),Ne="Progress",Te=100,[Ae,_e]=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=[];const r=()=>{const n=o.map((t=>e.createContext(t)));return function(o){const r=(null==o?void 0:o[t])||n;return e.useMemo((()=>({["__scope".concat(t)]:{...o,[t]:r}})),[o,r])}};return r.scopeName=t,[function(n,r){const i=e.createContext(r),l=o.length;function a(n){const{scope:o,children:r,...a}=n,s=(null==o?void 0:o[t][l])||i,c=e.useMemo((()=>a),Object.values(a));return e.createElement(s.Provider,{value:c},r)}return o=[...o,r],a.displayName=n+"Provider",[a,function(o,a){const s=(null==a?void 0:a[t][l])||i,c=e.useContext(s);if(c)return c;if(void 0!==r)return r;throw new Error("`".concat(o,"` must be used within `").concat(n,"`"))}]},be(r,...n)]}(Ne),[De,Re]=Ae(Ne),Pe=e.forwardRef(((t,n)=>{const{__scopeProgress:o,value:r,max:i,getValueLabel:l=Le,...a}=t,s=Fe(i)?i:Te,c=Ke(r,s)?r:null,u=ze(c)?l(c,s):void 0;return e.createElement(De,{scope:o,value:c,max:s},e.createElement(Me.div,we({"aria-valuemax":s,"aria-valuemin":0,"aria-valuenow":ze(c)?c:void 0,"aria-valuetext":u,role:"progressbar","data-state":He(c,s),"data-value":null!=c?c:void 0,"data-max":s},a,{ref:n})))}));Pe.propTypes={max(e,t,n){const o=e[t],r=String(o);return o&&!Fe(o)?new Error(function(e,t){return"Invalid prop `max` of value `".concat(e,"` supplied to `").concat(t,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(Te,"`.")}(r,n)):null},value(e,t,n){const o=e[t],r=String(o),i=Fe(e.max)?e.max:Te;return null==o||Ke(o,i)?null:new Error(function(e,t){return"Invalid prop `value` of value `".concat(e,"` supplied to `").concat(t,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(Te," if no `max` prop is set)\n  - `null` if the progress is indeterminate.\n\nDefaulting to `null`.")}(r,n))}};const Oe=e.forwardRef(((t,n)=>{var o;const{__scopeProgress:r,...i}=t,l=Re("ProgressIndicator",r);return e.createElement(Me.div,we({"data-state":He(l.value,l.max),"data-value":null!==(o=l.value)&&void 0!==o?o:void 0,"data-max":l.max},i,{ref:n}))}));function Le(e,t){return"".concat(Math.round(e/t*100),"%")}function He(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function ze(e){return"number"==typeof e}function Fe(e){return ze(e)&&!isNaN(e)&&e>0}function Ke(e,t){return ze(e)&&!isNaN(e)&&e<=t&&e>=0}const Ve=Pe,Ue=Oe;function je(){return e.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},e.createElement("path",{d:"M14.205 3.205L12.795 1.795L8 6.585L3.205 1.795L1.795 3.205L6.585 8L1.795 12.795L3.205 14.205L8 9.415L12.795 14.205L14.205 12.795L9.415 8L14.205 3.205Z",fill:"currentColor"}))}function Be(){return e.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},e.createElement("rect",{x:"13.3773",y:"10.5415",width:"5.30402",height:"14.7575",fill:"white"}),e.createElement("path",{d:"M29.71 24.97L23.77 15.11L17.64 4.94C16.89 3.69 15.11 3.69 14.36 4.94L8.23002 15.11L2.29002 24.97C1.50002 26.29 2.42002 28 3.94002 28H28.06C29.58 28 30.5 26.29 29.71 24.97ZM16 25C14.9 25 14 24.1 14 23C14 22 14.74 21.18 15.7 21.03C15.8 21.01 15.9 21 16 21C16.1 21 16.21 21.01 16.3 21.03C17.26 21.18 18 22 18 23C18 24.1 17.1 25 16 25ZM18 19H14V11H18V19Z",fill:"currentColor"}))}function We(t){let{alertLabel:n,cancelLabel:o,failed:r,onCancel:i,progress:l,total:a}=t;const[s]=e.useState((()=>"widget-datagrid-export-alert-".concat(C())));return e.createElement("div",{id:s,className:S("widget-datagrid-export-alert",{"widget-datagrid-export-alert-failed":r}),role:"status","aria-live":"off","aria-label":n},e.createElement("button",{role:"button",className:"btn btn-image btn-icon widget-datagrid-export-alert-cancel",onClick:i,"aria-label":o,tabIndex:0},e.createElement(je,null)),e.createElement("div",{className:"widget-datagrid-export-alert-message"},r?e.createElement(Be,null):e.createElement("p",null,Ge(a)?function(e,t){return"".concat(e," / ").concat(t)}(l,a):l)),e.createElement(Ze,{progress:l,total:a}))}function Ze(t){let{progress:n,total:o}=t;const r=Ge(o)&&o;return e.createElement(Ve,{className:"widget-datagrid-export-progress",value:r?n:null,max:o},e.createElement(Ue,{className:S("widget-datagrid-export-progress-indicator",{"widget-datagrid-export-progress-indicator-indeterminate":!r}),style:r?Xe(n,o):void 0}))}function Ge(e){return"number"==typeof e&&e>0}function Xe(e,t){return{transform:"translateX(-".concat(100-qe(e,0,t),"%)")}}function qe(e,t,n){if(e<t)return 0;if(e>n)return 100;const o=n-t,r=Math.round((e-t)/o*100);return Math.abs(r)}function Je(t){let{open:n,...o}=t;return n?e.createElement(ve,null,e.createElement(We,{...o})):null}function Ye(t){var n,o;const{className:r,columnsDraggable:i,columnsFilterable:l,columnsHidable:a,columnsResizable:s,columnsSortable:c,data:u,emptyPlaceholderRenderer:d,exporting:m,filterRenderer:h,headerContent:p,headerTitle:f,hasMoreItems:g,headerWrapperRenderer:v,id:w,numberOfItems:b,onExportCancel:y,page:C,pageSize:x,paging:E,pagingPosition:I,preview:k,processedRows:M,setPage:N,styles:A,CellComponent:_,state:D,actions:R,selectActionHelper:P}=t,L=k?D.allColumns:D.visibleColumns,H=(a?1:0)+(P.showCheckboxColumn?1:0),z=L.length+H,K=!E,[V,j]=e.useState(!1),[W,Z]=e.useState(void 0),G=!!p,X=E&&("top"===I||"both"===I),J=e.useCallback((t=>e.createElement("div",{className:"filter",style:{pointerEvents:V?"none":void 0}},t)),[V]),$=E?e.createElement(O,{canNextPage:g,canPreviousPage:0!==C,gotoPage:e=>N&&N((()=>e)),nextPage:()=>N&&N((e=>e+1)),numberOfItems:b,page:C,pageSize:x,previousPage:()=>N&&N((e=>e-1))}):null,ee=e.useMemo((()=>function(e,t,n){const o=e.map((n=>{const o=e.at(-1)===n,r=t[n.columnId];if(r)return o?"minmax(min-content, auto)":"".concat(r,"px");switch(n.width){case"autoFit":{const e="manual"===n.minWidth?"".concat(n.minWidthLimit,"px"):"minContent"===n.minWidth?"min-content":"auto";return"minmax(".concat(e,", auto)")}case"manual":return"".concat(n.weight,"fr");default:return"1fr"}})),r=[];n.selectItemColumn&&r.push("48px");r.push(...o),n.visibilitySelectorColumn&&r.push("54px");return{gridTemplateColumns:r.join(" ")}}(L,t.state.size,{selectItemColumn:P.showCheckboxColumn,visibilitySelectorColumn:a})),[t.state.size,L,a,P.showCheckboxColumn]),te="None"!==P.selectionType;return e.createElement(F,{value:t},e.createElement(fe,{className:r,selectionMethod:P.selectionMethod,selection:te,style:A,exporting:m},X&&e.createElement(ge,null,$),G&&e.createElement(pe,{headerTitle:f},p),e.createElement(me,{isInfinite:K,hasMoreItems:g,setPage:N},e.createElement(Y,{"aria-multiselectable":te?"Multi"===P.selectionType:void 0},e.createElement(Q,{style:ee},e.createElement("div",{key:"headers_row",className:"tr",role:"row"},e.createElement(U,{key:"headers_column_select_all"}),L.map(((n,o)=>v(o,e.createElement(ne,{key:"".concat(n.columnId),className:"align-column-".concat(n.alignment),gridId:t.id,column:n,draggable:i,dragOver:W,filterable:l,filterWidget:h(J,n.columnNumber),hidable:a,isDragging:V,preview:k,resizable:s&&L.at(-1)!==n,resizer:e.createElement(B,{onResizeStart:R.createSizeSnapshot,setColumnWidth:e=>R.resize([n.columnId,e])}),swapColumns:R.swap,setDragOver:Z,setIsDragging:j,setSortBy:R.sortBy,sortable:c,sortRule:D.sortOrder.find((e=>{let[t]=e;return n.columnId===t})),visibleColumns:D.visibleColumns,useHeaderRef:t.useHeaderRef})))),a&&e.createElement(q,{key:"headers_column_selector",columns:D.availableColumns,hiddenColumns:D.hidden,id:w,toggleHidden:R.toggleHidden,visibleLength:D.visibleColumns.length})),e.createElement(T,{focusController:t.focusController},u.map(((n,o)=>{var r;return e.createElement(se,{CellComponent:_,className:null===(r=t.rowClass)||void 0===r?void 0:r.call(t,n),columns:L,index:o,item:n,key:"row_".concat(n.id),showSelectorCell:a,preview:null!=k&&k,selectableWrapper:v})}))),(0===u.length||k)&&d&&d((t=>e.createElement("div",{key:"row-footer",className:S("td",{"td-borders":!k}),style:{gridColumn:"span ".concat(z)}},e.createElement("div",{className:"empty-placeholder"},t))))))),e.createElement(he,{pagination:$,pagingPosition:I}),e.createElement(Je,{alertLabel:null!==(n=t.exportDialogLabel)&&void 0!==n?n:"Export progress",cancelLabel:null!==(o=t.cancelExportLabel)&&void 0!==o?o:"Cancel data export",failed:!1,onCancel:y,open:m,progress:M,total:b})))}const Qe=e.memo((t=>{const n=(void 0===window[b]&&(window[b]=e.createContext(void 0)),window[b]),o=function(){let t=window[r];return null==t&&(t=e.createContext(void 0),window[r]=t),t}(),i=t.state,l=e.useMemo((()=>t.filterList.reduce(((e,t)=>{let{filter:n}=t;return{...e,[n.id]:n}}),{})),[t.filterList]),[a]=e.useState((()=>t.filterList.reduce(((e,n)=>{let{filter:o}=n;return{...e,[o.id]:s(o,t.viewStateFilters)}}),{})));return e.createElement(o.Provider,{value:{eventsChannelName:t.eventsChannelName,filterDispatcher:e=>{if(e.filterType){const[,n]=i[e.filterType];n(e),t.setFiltered(!0)}return e},multipleAttributes:l,multipleInitialFilters:a}},e.createElement(n.Provider,{value:t.selectionContextValue},t.children))}));Qe.displayName="WidgetHeaderContext";const $e=Qe;function et(e){if(null==e)throw new Error(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Did not expect an argument to be undefined");return e}function tt(e){if(e.filterAssociation)return function(e){const t=e=>"Can't map ColumnsType to AssociationProperties: ".concat(e," is undefined"),n=et(e.filterAssociation,t("filterAssociation")),o=et(e.filterAssociationOptions,t("filterAssociationOptions")),r=et(e.filterAssociationOptionLabel,t("filterAssociationOptionLabel"));return{association:n,optionsSource:o,getOptionLabel:e=>{var t;return null!==(t=r.get(e).value)&&void 0!==t?t:"Error: unable to get caption"}}}(e)}const nt=e=>e&&"available"===e.status&&e.value,ot="com.mendix.widgets.web.datagrid.export",rt=200,it=Symbol("overwrite"),lt=t=>{const[n,o]=function(t){let{columns:n,items:o=[],offset:r,limit:i=rt,hasMoreItems:l,updateDataSource:a}=t;const[s,c]=e.useReducer(st,at()),[u,d]=e.useMemo(ct,[]);return e.useEffect((()=>c({type:"DataSourceUpdate",payload:{items:o,offset:r,limit:i,hasMoreItems:l}})),[o,r,i,l]),e.useEffect((()=>{c({type:"ColumnsUpdate",payload:{columns:n}})}),[n]),e.useEffect((()=>{u(s,c,a)}),[s]),e.useEffect((()=>d),[]),[{currentLimit:s.currentLimit,exporting:s.exporting,items:s.exporting?s.snapshot.items:null!=o?o:[],processedRows:s.processedRows},c]}(t);e.useEffect((()=>{window[ot]||(window[ot]={}),window.DATAGRID_DATA_EXPORT||(window.DATAGRID_DATA_EXPORT="");let e,n=!1,r=!1;const i={create(){if(r)throw new Error("Data grid (Export): export stream is busy");let n=!1;return{process:(i,l)=>{const{limit:a=rt}=null!=l?l:{},s=e=>{"aborted"!==e.type&&"end"!==e.type||(r=!1,n=!1),i(e)};o({type:"Setup",payload:{callback:s,columns:t.columns,limit:Math.min(a,500)}}),e=()=>{r&&s({type:"aborted"})},n=!0},start:()=>{if(!n)throw new Error("Data grid (Export): can't start without handler.");o({type:"Start"})},abort:()=>{o({type:"Abort"})}}},[it]:()=>{n=!0}},l=window[ot][t.name];return l&&l[it](),window[ot][t.name]=i,window.DATAGRID_DATA_EXPORT=ot,()=>{null==e||e(),!1===n&&delete window[ot][t.name]}}),[]);return[n,e.useMemo((()=>({abort:()=>o({type:"Abort"})})),[o])]};function at(){return{callback:null,columns:null,currentItems:[],currentLimit:Number.POSITIVE_INFINITY,currentOffset:0,exporting:!1,hasMoreItems:!0,phase:"awaitingCallback",processedRows:0,snapshot:null}}function st(e,t){if("Reset"===t.type)return at();if("DataSourceUpdate"===t.type){if("awaitingCallback"===e.phase&&function(e,t){let{payload:n}=t;if(e.currentLimit===n.limit&&e.currentOffset===n.offset&&e.hasMoreItems==e.hasMoreItems&&e.currentItems.length===n.items.length)return e.currentItems.every(((e,t)=>{const o=n.items[t];return e.id===o.id}));return!1}(e,t))return e;const n=e.phase,o={...e,currentOffset:t.payload.offset,currentLimit:t.payload.limit,currentItems:t.payload.items,hasMoreItems:t.payload.hasMoreItems};return o.exporting&&"awaitingData"===n&&(o.phase="exportData"),o.exporting&&"resetOffset"===n&&(0===o.currentItems.length?o.phase="finished":o.phase="exportData"),o.exporting&&"finally"===n?{...at(),currentLimit:t.payload.limit,currentItems:t.payload.items,currentOffset:t.payload.offset}:o}if("ColumnsUpdate"===t.type&&("readyToStart"===e.phase||"exportColumns"===e.phase||"exportData"===e.phase||"awaitingCallback"===e.phase))return{...e,columns:t.payload.columns};if("Setup"===t.type&&"awaitingCallback"===e.phase)return{...e,phase:"readyToStart",snapshot:{items:e.currentItems,offset:e.currentOffset,limit:e.currentLimit},callback:t.payload.callback,columns:e.columns||t.payload.columns,currentLimit:t.payload.limit,currentOffset:0};if("Start"===t.type){if(e.exporting)return e;if("readyToStart"===e.phase&&e.callback instanceof Function)return{...e,phase:"exportColumns",exporting:!0};throw new Error("Datagrid (Export): Export start failed: invalid state.")}return"ColumnsExported"===t.type&&e.exporting&&"exportColumns"===e.phase?{...e,phase:"resetOffset"}:"PageExported"===t.type&&e.exporting&&"exportData"===e.phase?{...e,phase:"awaitingData",processedRows:e.processedRows+e.currentLimit}:"Finish"===t.type&&e.exporting?{...e,phase:"finished"}:"Abort"===t.type&&e.exporting?{...e,phase:"aborting"}:"ExportEnd"===t.type&&e.exporting?{...e,phase:"finally",processedRows:0}:e}function ct(){let e=null;const t=()=>(null===e&&(e=new ut),e),n=()=>{e=new ut};return[async(e,o,r)=>{const i=t();if(!1!==e.exporting)if("resetOffset"!==e.phase){if("exportColumns"===e.phase){const{columns:t,callback:n}=e;return await i.exec((()=>n(function(e){return{type:"columns",payload:e.map((e=>{var t,n,o,r;return{name:e.header&&nt(e.header)&&null!==(n=null===(t=e.header.value)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",type:null!==(r=null===(o=e.attribute)||void 0===o?void 0:o.type.toString())&&void 0!==r?r:""}}))}}(t)))),void i.exec((()=>o({type:"ColumnsExported"})))}if("exportData"!==e.phase)if("awaitingData"!==e.phase){if("aborting"===e.phase){const{callback:t}=e;return i.exec((()=>t({type:"aborted"}))),i.exec((()=>o({type:"ExportEnd"}))),void i.abort("abortAction")}if("finished"===e.phase){const{callback:t}=e;return i.exec((()=>t({type:"end"}))),void i.exec((()=>o({type:"ExportEnd"})))}if("finally"===e.phase){const{snapshot:t}=e;!1!==i.isAborted&&"abortAction"!==i.abortReason||r({offset:t.offset,limit:t.limit}),n()}}else{const{currentOffset:t,currentLimit:n,hasMoreItems:l}=e;l?i.exec((()=>r({offset:t+n}))):i.exec((()=>o({type:"Finish"})))}else{const{currentItems:t,callback:n,columns:r}=e;if(t.length>0){const e=function(e,t){let n=!1;const o=e.map((e=>t.map((t=>{var o,r,i,l,a;let s="";if("attribute"===t.showContentAs)s=null!==(i=null===(r=null===(o=t.attribute)||void 0===o?void 0:o.get(e))||void 0===r?void 0:r.displayValue)&&void 0!==i?i:"";else if("dynamicText"===t.showContentAs){const o=null===(l=t.dynamicText)||void 0===l?void 0:l.get(e);"loading"===(null==o?void 0:o.status)?n=!0:s="unavailable"===(null==o?void 0:o.status)?"n/a":null!==(a=null==o?void 0:o.value)&&void 0!==a?a:""}else s="n/a (custom content)";return s}))));return n?{status:"pending"}:{status:"ready",message:{type:"data",payload:o}}}(t,r);"ready"===e.status&&(await i.exec((()=>n(e.message))),i.exec((()=>o({type:"PageExported"}))))}}}else i.exec((()=>r({offset:0,limit:e.currentLimit,reload:!0})))},()=>{t().abort("unmount")}]}class ut{constructor(){this.aborted=!1,this.reason=null}async exec(e){this.isAborted||await e()}abort(e){this.aborted=!0,this.reason=e}get isAborted(){return this.aborted}get abortReason(){return this.reason}}function dt(e,t){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2166136261;const n=e.length;for(let o=0;o<n;o++)t^=e.charCodeAt(o),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}(JSON.stringify({name:t,columns:e.map((e=>({columnId:e.columnId,canSort:e.canSort,canHide:e.canHide,canResize:e.canResize,canDrag:e.canDrag})))})).toString()}function mt(e,t){return e.flatMap((e=>{let[n,o]=e;var r;const{attrId:i}=null!==(r=t.find((e=>e.columnId===n)))&&void 0!==r?r:{};return i?[[i,o]]:[]}))}function ht(e,t){return e.flatMap((e=>{let[n,o]=e;var r;const i=null===(r=t.find((e=>e.attrId===n)))||void 0===r?void 0:r.columnId;return i?[[i,o]]:[]}))}function pt(e,t){return{sortOrder:e.sortOrder,columnOrder:e.columnOrder,hidden:new Set(e.columns.flatMap((e=>e.hidden?[e.columnId]:[]))),size:Object.fromEntries(e.columns.map((e=>[e.columnId,e.size]))),filter:t.filter}}function ft(e,t){return{sortOrder:ht(t.sortOrder,e),size:{},hidden:new Set(e.flatMap((e=>e.initiallyHidden?[e.columnId]:[]))),columnOrder:e.map((e=>e.columnId)),filter:t.filter}}function gt(t,n,o){const[r,i]=e.useReducer(vt,{params:t,columns:n},xt),[l,a]=function(){const t=e.useRef(new Map),{current:n}=e.useRef((function(n){const o=e.useRef(null);return e.useEffect((()=>{const e=t.current;return e.set(n,o.current),()=>{e.delete(n)}}),[n]),o})),{current:o}=e.useRef((e=>e(t.current)));return[o,n]}(),s=e.useMemo((()=>{const e={resize:e=>i({type:"resize",payload:e}),setFilter:e=>i({type:"setFilter",payload:e}),sortBy:e=>i({type:"sortBy",payload:e}),swap:e=>i({type:"swap",payload:e}),toggleHidden:e=>i({type:"toggleHidden",payload:e}),setSize:e=>i({type:"setSize",payload:e}),createSizeSnapshot:()=>l((t=>e.setSize([...t.entries()].reduce(((e,t)=>{let[n,o]=t;return e[n]=o.clientWidth,e}),{}))))};return e}),[i,l]);return e.useEffect((()=>i({type:"setColumns",payload:n})),[n]),function(t,n){const o=e.useRef(void 0);e.useEffect((()=>{void 0!==o.current&&t(o.current,n),o.current=n}),n)}(((e,t)=>{let[n]=e,[r]=t;return o(n,r)}),[r]),[r,s,{useHeaderRef:a}]}function vt(e,t){switch(t.type){case"resize":return{...e,size:yt(e.size,t.payload)};case"setFilter":return e.filter===t.payload?e:{...e,filter:t.payload};case"setColumns":return e.allColumns===t.payload?e:function(e,t){const n=wt(t,e.columnOrder);let o=e.hidden,r=bt(n,o);0===r.length&&(o=new Set,r=bt(n,o));return{...e,allColumns:t,availableColumns:n,visibleColumns:r,hidden:o}}(e,t.payload);case"sortBy":return{...e,sortOrder:Ct(e.sortOrder,t.payload)};case"swap":{const n=function(e,t){let[n,o]=t;const r=e.indexOf(n),i=e.indexOf(o);if(-1===r||-1===i)return console.warn("Unable to find column in the current order array."),e;if(r!==i){const t=[...e];return t[r]=o,t[i]=n,t}return e}(e.columnOrder,t.payload),o=wt(e.allColumns,n);return{...e,columnOrder:n,availableColumns:o,visibleColumns:bt(o,e.hidden)}}case"toggleHidden":{const r=function(e,t,n){if(e.some((e=>!n.has(e.columnId))))return n;return t}(e.availableColumns,e.hidden,function(e,t){const n=new Set(e);!1===n.delete(t)&&n.add(t);return n}(e.hidden,t.payload));return e.hidden===r?e:{...e,hidden:r,sortOrder:(n=e.sortOrder,o=t.payload,n.flatMap((e=>e[0]===o?[]:[e]))),visibleColumns:bt(e.availableColumns,r)}}case"setSize":return{...e,size:t.payload};default:return e}var n,o}function wt(e,t){return function(e,t){const n=[...e],o=Object.fromEntries(t.map(((e,t)=>[e,t])));return n.sort(((e,t)=>o[e.columnId]-o[t.columnId])),n}(e,t).filter((e=>e.visible))}function bt(e,t){return e.filter((e=>!t.has(e.columnId)))}function yt(e,t){let[n,o]=t;return{...e,[n]:o}}function Ct(e,t){const[[n,o]=[]]=e;return n===t?"asc"===o?[[t,"desc"]]:[]:[[t,"asc"]]}function xt(e){let{params:t,columns:n}=e;const o=wt(n,t.columnOrder),r=bt(o,t.hidden);return{allColumns:n,availableColumns:o,columnOrder:t.columnOrder,filter:t.filter,hidden:t.hidden,size:t.size,sortOrder:t.sortOrder,visibleColumns:r}}const Et=t=>{const{pagination:n,showPagingButtons:o,totalCount:r,limit:i}=t;return e.useMemo((()=>"buttons"===n&&("always"===o||"auto"===o&&!!r&&r>i)),[n,o,r,i])};class St{constructor(e){this.properties=e}get alignment(){return this.properties.alignment}get canSort(){return this.properties.sortable}get canResize(){return this.properties.resizable}get canDrag(){return this.properties.draggable}get canHide(){return"no"!==this.properties.hidable}get initiallyHidden(){return"hidden"===this.properties.hidable}get weight(){var e;return null!==(e=this.properties.size)&&void 0!==e?e:1}get width(){return this.properties.width}get wrapText(){return this.properties.wrapText}get minWidth(){return this.properties.minWidth}get minWidthLimit(){return this.properties.minWidthLimit}}class It extends St{constructor(e,t){var n,o;super(e),this.props=e,this.columnNumber=t,this.visible=null!==(o=null===(n=e.visible)||void 0===n?void 0:n.value)&&void 0!==o&&o}columnClass(e){var t;return null===(t=this.props.columnClass)||void 0===t?void 0:t.get(e).value}get canSort(){var e;return super.canSort&&!!(null===(e=this.props.attribute)||void 0===e?void 0:e.sortable)}get columnId(){return this.columnNumber.toString()}get header(){var e,t;return null!==(t=null===(e=this.props.header)||void 0===e?void 0:e.value)&&void 0!==t?t:""}get status(){var e,t;return null!==(t=null===(e=this.props.visible)||void 0===e?void 0:e.status)&&void 0!==t?t:"loading"}get attrId(){var e;return null===(e=this.props.attribute)||void 0===e?void 0:e.id}setInitParams(){this.props.filterAssociationOptions&&this.props.filterAssociationOptions.setLimit(0)}renderCellContent(t){var n,o,r,i,l,a,s;switch(this.props.showContentAs){case"attribute":case"dynamicText":return e.createElement("span",{className:"td-text",title:null===(o=null===(n=this.props.tooltip)||void 0===n?void 0:n.get(t))||void 0===o?void 0:o.value},"attribute"===this.props.showContentAs?null===(i=null===(r=this.props.attribute)||void 0===r?void 0:r.get(t))||void 0===i?void 0:i.displayValue:null===(a=null===(l=this.props.dynamicText)||void 0===l?void 0:l.get(t))||void 0===a?void 0:a.value);case"customContent":return e.createElement(Nt,null,null===(s=this.props.content)||void 0===s?void 0:s.get(t));default:throw new Error("Unknown content type: ".concat(this.props.showContentAs))}}}const kt=e=>{e.stopPropagation()},Mt=e=>{"Tab"!==e.code&&e.stopPropagation()};function Nt(t){return e.createElement("div",{onClick:kt,onKeyUp:kt,onKeyDown:Mt,className:"td-custom-content"},t.children)}class Tt{constructor(e,t){this.attr=e,this.hash=t}load(){if("string"==typeof this.attr.value&&this.attr.value.length>0){const e=JSON.parse(this.attr.value);if(e.settingsHash===this.hash)return e;this.reset()}}save(e){this.attr.setValue(JSON.stringify(e))}reset(){this.attr.setValue(void 0)}}class At{constructor(){this.state=this.pending(),this.initialized=!1}getInitState(e,t,n,o,r){if("ready"===this.state.status)return this.state;if(this.initialized||(this.setInitParams(e,o,t,n),this.initialized=!0),"loading"===r.status||"loading"===e.status||o.some((e=>"loading"===e.status)))return this.pending();let i,l=!1;return"available"===r.status&&(i=r.settings.load(),i&&(this.setViewState(e,i,o),e.reload(),l=!0)),this.state=this.ready(e,o,i),l?this.pending():this.state}setInitParams(e,t,n,o){"buttons"===n&&e.requestTotalCount(!0),e.setLimit(o),t.forEach((e=>e.setInitParams()))}setViewState(e,t,n){t.sortOrder.length>0&&e.setSortOrder(mt(t.sortOrder,n))}ready(e,t,n){return{status:"ready",initParams:n?pt(n,e):ft(t,e)}}pending(){return{status:"pending"}}}const[_t,Dt]=((e,t)=>{let n=null;const o=()=>{null!==n&&(clearTimeout(n),n=null)};return[function(){for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];o(),n=setTimeout((()=>e(...i)),t)},o]})(((e,t)=>{e.save(t)}),500);function Rt(t){let{name:n,columns:o,datasource:r,pageSize:i,pagination:l,configurationAttribute:a}=t;const s=e.useMemo((()=>new At),[]),c=e.useMemo((()=>o.map(((e,t)=>new It(e,t)))),[o]),u=e.useMemo((()=>dt(c,n)),[n,c]),d=function(t,n){return e.useMemo((()=>"available"===(null==n?void 0:n.status)?{status:"available",settings:new Tt(n,t)}:"loading"===(null==n?void 0:n.status)?{status:"loading",settings:void 0}:{status:"unavailable",settings:void 0}),[t,n])}(u,a),m=j(((e,t)=>{if(e.filter!==t.filter&&r.setFilter(t.filter),e.sortOrder!==t.sortOrder&&r.setSortOrder(mt(t.sortOrder,c)),"available"===d.status){const e={schemaVersion:1,settingsHash:(o={settingsHash:u,name:n,columns:t.allColumns,hidden:t.hidden,columnOrder:t.columnOrder,size:t.size,sortOrder:t.sortOrder}).settingsHash,name:o.name,sortOrder:o.sortOrder,columnOrder:o.columnOrder,columns:o.columns.map((e=>{let{columnId:t}=e;return{columnId:t,hidden:o.hidden.has(t),size:o.size[t],filterSettings:void 0}}))};_t(d.settings,e)}var o}));return e.useEffect((()=>Dt),[]),{initState:s.getInitState(r,l,i,c,d),columns:c,stateChangeFx:m}}class Pt extends y{constructor(e,t,n,o,r){super(e,t),this._selectionMethod=n,this._showSelectAllToggle=o,this.pageSize=r}get selectionMethod(){return"None"===this.selectionType?"none":this._selectionMethod}get showCheckboxColumn(){return"checkbox"===this.selectionMethod}get showSelectAllToggle(){return this._showSelectAllToggle&&"Multi"===this.selectionType}}class Ot{constructor(e,t){this.trigger=e,this.listAction=t,this.onExecuteAction=e=>{this.listAction&&"get"in this.listAction&&d(this.listAction.get(e))}}get clickTrigger(){return this.listAction?this.trigger:"none"}update(e){this.listAction=e}}function Lt(e,t){const n=function(e){return e.reduce(((e,t)=>{var n,o,r,i,l,a;switch(t.eventName){case"onClick":e.onClick=null!==(n=e.onClick)&&void 0!==n?n:[],e.onClick.push(t);break;case"onDoubleClick":e.onDoubleClick=null!==(o=e.onDoubleClick)&&void 0!==o?o:[],e.onDoubleClick.push(t);break;case"onKeyDown":e.onKeyDown=null!==(r=e.onKeyDown)&&void 0!==r?r:[],e.onKeyDown.push(t);break;case"onKeyUp":e.onKeyUp=null!==(i=e.onKeyUp)&&void 0!==i?i:[],e.onKeyUp.push(t);break;case"onMouseDown":e.onMouseDown=null!==(l=e.onMouseDown)&&void 0!==l?l:[],e.onMouseDown.push(t);break;case"onFocus":e.onFocus=null!==(a=e.onFocus)&&void 0!==a?a:[],e.onFocus.push(t)}return e}),{})}(t);return{onClick(t){var o;null===(o=n.onClick)||void 0===o||o.forEach((n=>Ht(e,t,n)))},onDoubleClick(t){var o;null===(o=n.onDoubleClick)||void 0===o||o.forEach((n=>Ht(e,t,n)))},onKeyUp(t){var o;null===(o=n.onKeyUp)||void 0===o||o.forEach((n=>Ht(e,t,n)))},onKeyDown(t){var o;null===(o=n.onKeyDown)||void 0===o||o.forEach((n=>Ht(e,t,n)))},onMouseDown(t){var o;null===(o=n.onMouseDown)||void 0===o||o.forEach((n=>Ht(e,t,n)))},onFocus(t){var o;null===(o=n.onFocus)||void 0===o||o.forEach((n=>Ht(e,t,n)))}}}function Ht(e,t,n){const o=e();(!n.filter||n.filter(o,t))&&n.handler(o,t)}const zt=e=>({eventName:"onClick",filter:(e,t)=>"single"===e.clickTrigger&&"none"===e.selectionMethod||"single"===e.clickTrigger&&"checkbox"===e.selectionMethod&&!t.metaKey&&!t.ctrlKey,handler:t=>{let{item:n}=t;return e(n)}}),Ft=e=>({eventName:"onDoubleClick",filter:(e,t)=>"none"===e.selectionMethod?"double"===e.clickTrigger:"double"===e.clickTrigger&&!t.metaKey&&!t.ctrlKey,handler:t=>{let{item:n}=t;return e(n)}}),Kt=(e,t)=>"Space"===t.code&&"none"!==e.clickTrigger?!t.shiftKey||"none"===e.selectionMethod:"Enter"===t.code&&"none"!==e.clickTrigger,Vt=e=>{let t=!1;return[{eventName:"onKeyDown",filter:Kt,handler:()=>t=!0},{eventName:"onKeyUp",filter:(e,n)=>Kt(e,n)&&t,handler:n=>{let{item:o}=n;t=!1,e(o)}}]};function Ut(e){return[zt(e),Ft(e),(t=e=>{e.preventDefault(),e.stopPropagation()},{eventName:"onKeyDown",filter:(e,t)=>function(e){return"Space"===e.code&&e.target===e.currentTarget}(t),handler:(e,n)=>t(n)}),...Vt(e)];var t}function jt(){var e;null===(e=window.getSelection())||void 0===e||e.removeAllRanges()}function Bt(){document.body.style.userSelect="none"}const Wt=()=>{Wt.timeoutId&&clearTimeout(Wt.timeoutId),Wt.timeoutId=window.setTimeout((()=>{jt(),document.body.style.userSelect="",Wt.timeoutId=void 0}),250)},Zt=e=>({eventName:"onClick",filter:(e,t)=>"rowClick"===e.selectionMethod?"double"===e.clickTrigger?t.metaKey||t.ctrlKey:"none"===e.clickTrigger:"checkbox"===e.selectionMethod&&(t.metaKey||t.ctrlKey),handler:(t,n)=>{let{item:o,selectionMethod:r,clickTrigger:i}=t;const l="checkbox"===r||"none"===i&&(n.metaKey||n.ctrlKey);e(o,n.shiftKey,l)}}),Gt=e=>({eventName:"onKeyUp",filter:(e,t)=>"none"!==e.selectionMethod&&function(e){return"Space"===e.code&&e.shiftKey}(t),handler:t=>{let{item:n,selectionMethod:o}=t;return e(n,!1,"checkbox"===o)}});const Xt=e=>({eventName:"onClick",handler:(t,n)=>e({type:"Mouse",reactEvent:n})}),qt=e=>({eventName:"onKeyDown",handler:(t,n)=>e({type:"Keyboard",reactEvent:n})}),Jt=e=>({eventName:"onFocus",handler:(t,n)=>e({type:"Focus",reactEvent:n})});function Yt(e){return[Xt(e),qt(e),Jt(e)]}class Qt{constructor(e,t,n,o,r,i){this.contextFactory=e,this.selectFx=t,this.selectAllFx=n,this.selectAdjacentFx=o,this.executeActionFx=r,this.focusTargetFx=i}getProps(e){var t,n,o,r;return Lt((()=>this.contextFactory(e)),[...(t=this.selectFx,n=this.selectAllFx,o=this.selectAdjacentFx,[(r=jt,{eventName:"onMouseDown",filter:e=>"none"!==e.selectionMethod,handler:r}),Zt(t),Gt(t),v((()=>{Bt(),n("selectAll")}),(()=>Wt())),w(o)].flat()),...Ut(this.executeActionFx),...Yt(this.focusTargetFx)])}}const $t=e=>({eventName:"onClick",filter:e=>"checkbox"===e.selectionMethod,handler:(t,n)=>{let{item:o}=t;return e(o,n.shiftKey,!0)}});function en(e,t,n){return[$t(e),...w(n),...v((()=>{Bt(),t("selectAll")}),(()=>Wt()))]}class tn{constructor(e,t,n,o,r){this.contextFactory=e,this.selectFx=t,this.selectAllFx=n,this.selectAdjacentFx=o,this.focusTargetFx=r,this.getProps=e=>Lt((()=>this.contextFactory(e)),[...en(this.selectFx,this.selectAllFx,this.selectAdjacentFx),...Yt(this.focusTargetFx)])}}class nn{constructor(e,t){u(this,"_listeners",void 0),u(this,"_focusTarget",void 0),u(this,"_positionController",void 0),u(this,"_layout",void 0),u(this,"dispatch",(e=>{const t=this._positionController.dispatch(e,this._layout);void 0!==t&&t!==this._focusTarget&&("Keyboard"===e.type?this._setTargetAndFocus(t):this._setTarget(t))})),this._listeners=[],this._focusTarget=this._getInitPosition(),this._positionController=e,this._layout=t}get focusTarget(){return this._focusTarget}addListener(e){this._listeners.push(e)}removeListener(e){this._listeners.splice(this._listeners.indexOf(e),1)}updateGridLayout(e){this._layout=e,void 0===this._layout.get(_(this._focusTarget))&&this._setTarget(this._getInitPosition())}_setTarget(e){const t=this._focusTarget;this._focusTarget=e,this._emit({lastPos:t,targetPos:e,shouldFocus:!1})}_setTargetAndFocus(e){const t=this._focusTarget;this._focusTarget=e,this._emit({lastPos:t,targetPos:e,shouldFocus:!0})}_emit(e){for(const t of this._listeners)t(e)}_getInitPosition(){return A(0,0)}}class on{constructor(e,t,n){u(this,"rows",void 0),u(this,"columns",void 0),u(this,"pageSize",void 0),u(this,"_positions",void 0),this.columns=t,this.rows=e,this.pageSize=n,this._positions=new Set;for(let n=0;n<e;n+=1)for(let e=0;e<t;e+=1)this._positions.add(A(e,n))}get(e){let[t,n]=e;const o=A(t<0?this.columns+t:t,n<0?this.rows+n:n);if(this._positions.has(o))return o}}const rn=new Set(["ArrowUp","ArrowRight","ArrowDown","ArrowLeft","PageUp","PageDown","End","Home"]);const ln={ArrowUp:function(e){let[t,n]=e;return[t,Math.max(0,n-1)]},ArrowRight:function(e){let[t,n]=e;return[t+1,n]},ArrowDown:function(e){let[t,n]=e;return[t,n+1]},ArrowLeft:function(e){let[t,n]=e;return[Math.max(0,t-1),n]},PageUp:(e,t)=>function(e,t){let[n,o]=e;return[n,Math.max(0,o-t)]}(e,t.pageSize),PageDown:(e,t)=>function(e,t,n){let[o,r]=e;return[o,Math.min(n-1,r+t)]}(e,t.pageSize,t.rows),End:(e,t,n)=>{let{ctrlKey:o}=n;return o?[-1,-1]:function(e){let[t,n]=e;return[-1,n]}(e)},Home:(e,t,n)=>{let{ctrlKey:o}=n;return o?[0,0]:function(e){let[t,n]=e;return[0,n]}(e)}};class an{dispatch(e,t){return"Focus"===e.type?this._handleFocusEvent(e.reactEvent):"Mouse"===e.type?this._handleMouseEvent(e.reactEvent):this._handleKeyboardEvent(e.reactEvent,t)}_handleKeyboardEvent(e,t){if(n=e.code,!rn.has(n))return;var n;if(!Object.hasOwn(ln,e.code))throw new Error("Keyboard nav: can't find handler for ".concat(e.code," key"));e.preventDefault();const o=_(this._getTargetPosition(e));return t.get(ln[e.code](o,t,e))}_handleMouseEvent(e){return this._getTargetPosition(e)}_handleFocusEvent(e){return this._getTargetPosition(e)}_getTargetPosition(e){var t;const n=null===(t=e.currentTarget.dataset)||void 0===t?void 0:t.position;if(void 0===n)throw new Error("Keyboard navigation: target position is missing");return n}}const sn=Object.freeze({reset:{value:"reset.value",filters:"reset.filters"}});let cn=()=>({emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];for(let t=0,o=this.events[e]||[],r=o.length;t<r;t++)o[t](...n)},events:{},on(e,t){var n;return((n=this.events)[e]||(n[e]=[])).push(t),()=>{var n;this.events[e]=null===(n=this.events[e])||void 0===n?void 0:n.filter((e=>t!==e))}}});const un="com.mendix.widgets.web.plugin.externalEvents";class dn{constructor(){u(this,"channels",void 0),u(this,"id",Math.random().toString().slice(2)),this.channels=new Map}disposeChannel(e){const t=this.channels.get(e);return t&&(t.events={}),this.channels.delete(e)}getChannel(e){let t=this.channels.get(e);return t||(t=cn(),this.channels.set(e,t),t)}emit(e,t){for(var n,o=arguments.length,r=new Array(o>2?o-2:0),i=2;i<o;i++)r[i-2]=arguments[i];null===(n=this.channels.get(e))||void 0===n||n.emit(t,...r)}subscribe(e,t,n){return this.getChannel(e).on(t,n),()=>this.unsubscribe(e,t,n)}unsubscribe(e,t,n){const o=this.channels.get(e);if(!o)return;const r=o.events[t];r&&(o.events[t]=r.filter((e=>e!==n)));0===Object.values(o.events).flat().reduce(((e,t)=>t?e+1:e),0)&&this.disposeChannel(e)}}function mn(){var e,t;return null!==(t=(e=window)[un])&&void 0!==t?t:e[un]=function(){if(Object.prototype.hasOwnProperty.call(window,un))throw new Error("Widget plugin external events: plugin already initialized!");return new dn}()}const hn=function(){return mn().emit(...arguments)};function pn(t){var n,o,r;n=t.inputChannel,o=t.event,r=e.useRef((()=>t.onEvent(hn))).current,e.useEffect((()=>{if(void 0!==n)return mn().subscribe(n,o,r)}),[n,o])}function fn(n){var r,l,a,c,u;const d="virtualScrolling"===n.pagination,m=d?n.datasource.limit/n.pageSize:n.datasource.offset/n.pageSize,h=e.useRef(void 0),[p,g]=e.useState(!1),v={[o.STRING]:e.useState(),[o.NUMBER]:e.useState(),[o.DATE]:e.useState(),[o.ENUMERATION]:e.useState(),[o.ASSOCIATION]:e.useState()},{FilterContext:w}=i(),[b,y,{useHeaderRef:x}]=gt(n.initParams,n.mappedColumns,n.onStateChange),[{items:E,exporting:S,processedRows:I},{abort:k}]=lt({columns:e.useMemo((()=>b.visibleColumns.map((e=>n.columns[e.columnNumber]))),[b.visibleColumns,n.columns]),hasMoreItems:n.datasource.hasMoreItems||!1,items:n.datasource.items,name:n.name,offset:n.datasource.offset,limit:n.datasource.limit,updateDataSource:e.useCallback((e=>{let{offset:t,limit:o,reload:r}=e;var i,l;null!=t&&(null===(i=n.datasource)||void 0===i||i.setOffset(t)),null!=o&&(null===(l=n.datasource)||void 0===l||l.setLimit(o)),r&&n.datasource.reload()}),[n.datasource])});e.useEffect((()=>{!n.datasource.filter||p||h.current||(h.current=n.datasource.filter)}),[n.datasource,p]),e.useEffect((()=>{n.refreshInterval>0&&setTimeout((()=>{n.datasource.reload()}),1e3*n.refreshInterval)}),[n.datasource,n.refreshInterval]);const M=e.useCallback((e=>{const t=e(m);d?n.datasource.setLimit(t*n.pageSize):n.datasource.setOffset(t*n.pageSize)}),[n.datasource,n.pageSize,d,m]),N=n.columns.map((()=>e.useState())),T=N.map((e=>{let[t]=e;return t})),A=Object.keys(v).map((e=>v[e][0])),_=e.useMemo((()=>N.map((e=>{let[t]=e;var n;return null===(n=null==t?void 0:t.getFilterCondition)||void 0===n?void 0:n.call(t)})).filter((e=>void 0!==e)).concat(Object.keys(v).map((e=>{var t;return null===(t=v[e][0])||void 0===t?void 0:t.getFilterCondition()})).filter((e=>void 0!==e)))),[...T,...A]);e.useEffect((()=>{_.length>0?y.setFilter(_.length>1?t.and(..._):_[0]):p?y.setFilter(void 0):y.setFilter(h.current)}),[_,p,y]);const D=f(n.itemSelection,n.datasource,n.onSelectionChange),P=function(t,n){return e.useMemo((()=>{var e;return new Pt(t.itemSelection,n,t.itemSelectionMethod,t.showSelectAllToggle,null!==(e=t.pageSize)&&void 0!==e?e:5)}),[n])}({itemSelection:n.itemSelection,itemSelectionMethod:n.itemSelectionMethod,showSelectAllToggle:n.showSelectAllToggle,pageSize:n.pageSize},D),O=function(t){const n=e.useMemo((()=>new Ot(t.onClickTrigger,t.onClick)),[]);return e.useEffect((()=>{n.update(t.onClick)})),n}({onClickTrigger:n.onClickTrigger,onClick:n.onClick}),L=e.useMemo((()=>"datagrid/".concat(C())),[]);var H,z;H=n.name,z=L,pn(e.useRef({inputChannel:H,event:sn.reset.filters,onEvent:e=>e(z,sn.reset.value)}).current);const F=P.showCheckboxColumn?b.visibleColumns.length+1:b.visibleColumns.length,K=function(t){let{rows:n,columns:o,pageSize:r}=t;const i=e.useRef(null);return e.useMemo((()=>{const e=new on(n,o,r);return null===i.current?i.current=new nn(new an,e):i.current.updateGridLayout(e),i.current}),[n,o,r])}({rows:E.length,columns:F,pageSize:n.pageSize}),V=function(t,n,o){return e.useMemo((()=>new Qt((e=>({item:e,pageSize:t.pageSize,selectionType:t.selectionType,selectionMethod:t.selectionMethod,clickTrigger:n.clickTrigger})),t.onSelect,t.onSelectAll,t.onSelectAdjacent,n.onExecuteAction,o.dispatch)),[t,n,o])}(P,O,K),U=function(t,n){return e.useMemo((()=>new tn((e=>({item:e,pageSize:t.pageSize,selectionType:t.selectionType,selectionMethod:t.selectionMethod})),t.onSelect,t.onSelectAll,t.onSelectAdjacent,n.dispatch)),[t,n])}(P,K),j=function(t){const n=e.useCallback((()=>{"Multi"===(null==t?void 0:t.type)&&("all"===t.selectionStatus?t.selectNone():t.selectAll())}),[t]),o="Multi"===(null==t?void 0:t.type)?t.selectionStatus:void 0;return e.useMemo((()=>{if(void 0!==o)return{status:o,toggle:n}}),[o,n])}(D);return e.createElement(Ye,{className:n.class,CellComponent:R,columnsDraggable:n.columnsDraggable,columnsFilterable:n.columnsFilterable,columnsHidable:n.columnsHidable,columnsResizable:n.columnsResizable,columnsSortable:n.columnsSortable,data:E,emptyPlaceholderRenderer:e.useCallback((t=>"custom"===n.showEmptyPlaceholder?t(n.emptyPlaceholder):e.createElement("div",null)),[n.emptyPlaceholder,n.showEmptyPlaceholder]),filterRenderer:e.useCallback(((t,o)=>{const r=n.columns[o],{attribute:i,filter:l}=r,a=tt(r),[,c]=N[o],u=s(i,h.current);return t(i||a?e.createElement(w.Provider,{value:{eventsChannelName:L,filterDispatcher:e=>(g(!0),c(e),e),singleAttribute:i,singleInitialFilter:u,associationProperties:a}},l):l)}),[w,N,n.columns,L]),headerTitle:null===(r=n.filterSectionTitle)||void 0===r?void 0:r.value,headerContent:n.filtersPlaceholder&&e.createElement($e,{filterList:n.filterList,setFiltered:g,viewStateFilters:h.current,selectionContextValue:j,state:v,eventsChannelName:L},n.filtersPlaceholder),hasMoreItems:null!==(l=n.datasource.hasMoreItems)&&void 0!==l&&l,headerWrapperRenderer:e.useCallback(((e,t)=>t),[]),id:e.useMemo((()=>"DataGrid".concat(C())),[]),numberOfItems:n.datasource.totalCount,onExportCancel:k,page:m,pageSize:n.pageSize,paging:Et({pagination:n.pagination,showPagingButtons:n.showPagingButtons,totalCount:n.datasource.totalCount,limit:n.datasource.limit}),pagingPosition:n.pagingPosition,rowClass:e.useCallback((e=>{var t,o,r;return null!==(r=null===(o=null===(t=n.rowClass)||void 0===t?void 0:t.get(e))||void 0===o?void 0:o.value)&&void 0!==r?r:""}),[n.rowClass]),rowClickable:!(!n.itemSelection&&!n.onClick),setPage:M,styles:n.style,valueForSort:e.useCallback(((e,t)=>{const o=n.columns[t];return o.attribute?o.attribute.get(e).value:""}),[n.columns]),selectionStatus:"Multi"===(null==D?void 0:D.type)?D.selectionStatus:"unknown",exporting:S,processedRows:I,exportDialogLabel:null===(a=n.exportDialogLabel)||void 0===a?void 0:a.value,cancelExportLabel:null===(c=n.cancelExportLabel)||void 0===c?void 0:c.value,selectRowLabel:null===(u=n.selectRowLabel)||void 0===u?void 0:u.value,state:b,actions:y,selectActionHelper:P,cellEventsController:V,checkboxEventsController:U,focusController:K,useHeaderRef:x})}return function(t){const{initState:n,columns:o,stateChangeFx:r}=Rt(t);return"pending"===n.status?null:e.createElement(fn,{...t,initParams:n.initParams,mappedColumns:o,onStateChange:r})}}));
